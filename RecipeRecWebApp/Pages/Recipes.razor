@page "/"
@using RecipeRecWebApp.Contracts
@using Models
@using RecipeRecWebApp.Components
@inject IJSRuntime JSRuntime;
@inject ILogger<Recipes> logger;
@inject IIngredientService IngredientService;
@inject NavigationManager Navigation


<PageTitle>Recipes</PageTitle>

<div class="grid-container">
	<div class="ingredients">
		<div class="container mt-3">
			<div class="search-bar mb-3">
				<input type="text" class="form-control" placeholder="Search Ingredients" @bind="searchTerm" @onkeyup="HandleKeyDown" />
			</div>
			@if (isLoading)
			{
				<p>Loading...</p>
			}

			@if (isAddIngredientVisible)
			{
				<div class="add-ingredient-section mt-3">
					<h5>Add New Ingredient</h5>
					<div class="form-group">
						<label for="ingredientCategory">Select Category</label>
						<select id="ingredientCategory" class="form-control" @bind="selectedCategory">
							<option value="">-- Select Category --</option>
							@foreach (var category in SharedDataModel.Categories)
							{
								<option value="@category.Name">@category.Name</option>
							}
						</select>
					</div>

					<div class="form-group mt-3">
						<label for="ingredientName">Ingredient Name</label>
						<input id="ingredientName" type="text" class="form-control" @bind="newIngredientName" />
					</div>

					<button class="btn btn-primary mt-3" @onclick="AddIngredient">Add</button>
				</div>
			}
			else
			{

				<button class="btn btn-primary mt-3" @onclick="ToggleAddIngredientFields">Add Ingredient</button>
			}

			<div class="alert alert-secondary" role="alert">
				The only ingredients we assume you have are salt, pepper, and water.
			</div>

			@foreach (var category in FilteredCategories)
			{
				<div class="category-section mb-3">
					<div class="category-header d-flex justify-content-between align-items-center" @onclick="() => ToggleCategory(category.Name)">
						<div class="d-flex align-items-center">
							<h5 class="m-0">@category.Name (@category.Ingredients.Count)</h5>
						</div>
						<button class="btn btn-link">
							<i class="bi @(category.IsExpanded ? "bi-chevron-up" : "bi-chevron-down")"></i>
						</button>
					</div>
					@if (category.IsExpanded)
					{
						<div class="ingredients-grid mt-2">
							@foreach (var ingredient in category.Ingredients)
							{
								if (ingredient.Visible)
								{
									<div class="ingredient-card @(ingredient.Selected ? "selected" : "")" @onclick="() => ToggleIngredientSelection(ingredient)">
										<span>@ingredient.Name</span>
									</div>
								}
							}
						</div>
					}
				</div>
			}
		</div>
	</div>
	<div class="recipes">
		<div class="grid-container">
			<div class="basket">

				<button @onclick="HandleSearchClick" class="btn btn-primary mt-3">
					<i class="bi bi-search"></i> Search Recipe
				</button>

				@if (showWarning)
				{
					<span class="text-danger"> Please Select the Ingredient to Search the Recipe</span>

				}
			</div>
		</div>
	</div>
</div>